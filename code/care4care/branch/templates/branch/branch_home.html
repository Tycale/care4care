{% extends "base.html" %}
{% load bootstrap3 %}{% load i18n %}{% load staticfiles %}{% load jobs_extra %}


{% block title %}{{ branch }}{% endblock %}

{% block extra_head %}
<script src="http://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=places"></script>
{% endblock %}

{% block content %}
<div class="row mt">
    <div class="col-lg-12">
            <div id="map" style="width: 100%; min-height: 300px;">
            </div>
            <div style="display:none;">
            <div id="title-branch">
                <h3><i class="fa fa-angle-right"></i> {% trans "Branche" %} {{ branch }}</h3>
                {% if nb_users != 0 %}
                <h5><i class="fa fa-user"></i>
                    {% blocktrans count nb=nb_users %}
                        {{nb}} participant
                    {% plural %}
                        {{nb}} participants
                    {% endblocktrans %}
                </h5>
                {% endif %}
            </div>
            <div id="options-branch">
                {% if branch.creator.id != request.user.id or not request.user.is_superuser %}
                <button class="btn btn-danger btn-sm" data-toggle="modal" data-target="#modal-leave">
                    {% trans "Quitter cettte branche" %}
                </button>
                {% else %}
                <button class="btn btn-danger btn-sm" data-toggle="modal" data-target="#modal-delete">
                    {% trans "Supprimer cettte branche" %}
                </button>
                {% endif %}
            </div>
            </div>
            {% if branch.creator.id != request.user.id or not request.user.is_superuser %}
            <div class="modal fade" id="modal-leave" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                            <h4 class="modal-title" id="myModalLabel">{% trans "Quitter la branche ?" %}</h4>
                        </div>
                        <div class="modal-body">
                            {% blocktrans %}
                            Êtes-vous sûr de vouloir quitter la branche {{branch}} ?
                            {% endblocktrans %}
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">{% trans "fermer" %}</button>
                            <a href="{% url 'branch_leave' branch_id=branch.id user_id=request.user.id %}"
                    class="btn btn-danger">{% trans "Quitter cettte branche" %}</a>
                        </div>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="modal fade" id="modal-delete" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                            <h4 class="modal-title" id="myModalLabel">{% trans "Supprimer la branche ?" %}</h4>
                        </div>
                        <div class="modal-body">
                            {% blocktrans %}
                            Êtes-vous sûr de vouloir SUPPRIMER la branche {{branch}} ? <br />
                            Cette action est irréversible. <br />
                            {% endblocktrans %}
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">{% trans "fermer" %}</button>
                            <a href="{% url 'branch_delete' branch_id=branch.id %}"
                    class="btn btn-danger">{% trans "SUPPRIMER cettte branche" %}</a>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
    </div>
</div>

<div class="row mt">
  <div class="col-md-4 col-md-offset-2"> <a class="btn btn-primary btn-lg" href="{% url "need_help" branch_id=branch.id slug=branch.slug %}">{% trans "J'ai besoin d'aide" %}</a> </div>
  <div class="col-md-4 col-md-offset-2"><a class="btn btn-primary btn-lg" href="{% url "offer_help" branch_id=branch.id slug=branch.slug %}">{% trans "Offrir mon aide" %}</a></div>
</div>

<div class="row mt">
  {% show_demands request demands show_branch=False %}
  {% show_offers request offers show_branch=False %}
</div>


<div class="row mt">
    <div class="col-lg-12">

    	<div class="content-panel">
            <h4><i class="fa fa-angle-right"></i> {% trans "Liste des membres" %}</h4>

            <table class="table table-striped table-advance table-hover">
	    	  	  
	    	  	  
                <thead>
                <tr>
                    <th><i class="fa fa-user"></i> {% trans "Utilisateur" %}</th>
                    <th><i class="fa fa-bookmark"></i> {% trans "Nom complet" %}</th>
                    <th><i class="fa fa-star"></i> {% trans "Status" %}</th>
                    {% if request.user == branch.creator or request.user.is_superuser %}
                    <th></th>
                    {% endif %}
                </tr>
                </thead>
                <tbody>
                	{% for member in branch.membership.all %}          	
                	<tr>
                	    <td><a href="#">{{member.user}}</a></td>
                	    <td>{{member.user.get_full_name}}</td>
                	    <td>{% if member.is_admin %}{% trans "Responsable" %}{% endif %}</td>
                        {% if request.user == branch.creator or request.user.is_superuser %}
                	    <td>
                	        <a class="btn btn-primary btn-xs" href="{% url 'edit_profile' member.user.id %}"><i class="fa fa-pencil"></i></a>
                	        <a class="btn btn-danger btn-xs" href="{% url 'branch_leave' branch_id=branch.id user_id=member.user.id %}"><i class="fa fa-trash-o "></i></a>
                	    </td>
                        {% endif %}
                	</tr>
                	{% endfor %}
                </tbody>
            </table>
        </div>

    </div>
</div>
{% endblock %}


{% block extra_footer %}
<script type="text/javascript">
$(document).ready(function () {
    var options = {
        zoom: 13,
        center: new google.maps.LatLng({{branch.latitude}}, {{branch.longitude}}),
        disableDefaultUI: true,
        panControl: false,
        overviewMapControl: false,
        streetViewControl: false,
        scaleControl: false,
        rotateControl: false,
        draggable: false,
        zoomControl: false,
        scrollwheel: false,
        disableDoubleClickZoom: true,
        mapTypeId: google.maps.MapTypeId.HYBRID,
    };
    var map = new google.maps.Map(document.getElementById('map'), options);

    var titleBranch = document.getElementById('title-branch');
    map.controls[google.maps.ControlPosition.LEFT_TOP].push(titleBranch); 

    var optionsBranch = document.getElementById('options-branch');
    map.controls[google.maps.ControlPosition.RIGHT_TOP].push(optionsBranch); 

    $('.fa-bars').click(function () {
        google.maps.event.trigger(map, 'resize');
    });
});
</script>
{% endblock %}

